<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Uploading supporting documents | Customs Declarations End-to-End Service Guide - HMRC Developer Hub</title>

    <link href="/guides/customs-declarations-end-to-end-service-guide/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="docs.developer.service.hmrc.gov.uk/guides/customs-declarations-end-to-end-service-guide/documentation/uploading-supporting-documents.html">


      <meta property="og:image" content="docs.developer.service.hmrc.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="HMRC Developer Hub" />
      <meta property="og:title" content="Uploading supporting documents | Customs Declarations End-to-End Service Guide" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="docs.developer.service.hmrc.gov.uk/guides/customs-declarations-end-to-end-service-guide/documentation/uploading-supporting-documents.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:image" content="docs.developer.service.hmrc.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="Uploading supporting documents | Customs Declarations End-to-End Service Guide - HMRC Developer Hub" />
      <meta property="twitter:url" content="docs.developer.service.hmrc.gov.uk/guides/customs-declarations-end-to-end-service-guide/documentation/uploading-supporting-documents.html" />

      <!--[if !IE]>-->
  <script
    src="/tracking-consent/tracking.js"
    id="tracking-consent-script-tag"
    data-gtm-container="b"
    data-language="en"
  ></script>
  <!--<![endif]-->

  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="https://developer.service.hmrc.gov.uk/api-documentation" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          HMRC Developer Hub
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/guides/customs-declarations-end-to-end-service-guide">Customs Declarations End-to-End Service Guide</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/api-documentation/docs/using-the-hub">Documentation</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/developer/applications">Applications</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/developer/support">Support</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              
              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading" data-module="collapsible-navigation">
                      <ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/"><span>Customs Declaration Service end-to-end service guide</span></a>
    <ul>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/#overview"><span>Overview</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/#end-to-end-user-journeys"><span>End-to-end user journeys</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/#technical-documentation"><span>Technical Documentation</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html"><span>Developer set-up</span></a>
    <ul>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html#the-path-to-production"><span>The Path to Production</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html#developer-set-up-trade-test"><span>Trade Test</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html#developer-set-up-trader-dress-rehearsal"><span>Trader Dress Rehearsal</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html#api-subscription-model"><span>API subscription model</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html#api-access-control"><span>API access control</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html#api-versioning"><span>API versioning</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html#api-rate-limiting"><span>API rate limiting</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html#related-api-documentation"><span>Related API documentation</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html#authentication"><span>Authentication</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/set-up-developers.html#error-handling-best-practices"><span>Error Handling Best Practices</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/submitting-import-and-export-customs-declarations.html"><span>Submitting import and export customs declarations</span></a>
    <ul>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/submitting-import-and-export-customs-declarations.html#submit-new-declaration"><span>Submit new declaration</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/submitting-import-and-export-customs-declarations.html#amend-a-submitted-customs-declaration"><span>Amend a submitted customs declaration</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/submitting-import-and-export-customs-declarations.html#cancel-a-submitted-customs-declaration"><span>Cancel a submitted customs declaration</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/notifications.html"><span>Receiving notifications</span></a>
    <ul>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/notifications.html#notifications"><span>Notifications</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/notifications.html#push-notifications"><span>Push notifications</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/notifications.html#pull-notifications"><span>Pull notifications</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/notifications.html#notification-types-and-definitions"><span>Notification Types and definitions</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/notifications.html#notification-message-structure"><span>Notification message structure</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/uploading-supporting-documents.html"><span>File Upload Service</span></a>
    <ul>
      <li>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/uploading-supporting-documents.html#document-upload-process"><span>Document Upload Process</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/uploading-supporting-documents.html#using-the-file-upload-api-endpoint"><span>Using the File-Upload API endpoint</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/uploading-supporting-documents.html#detailed-steps"><span>Detailed Steps</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/uploading-supporting-documents.html#file-upload-capabilities-in-external-test"><span>File Upload Capabilities in External Test</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/query-declaration-status.html"><span>Query declaration status</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/inventory-linking-export-declarations.html"><span>Inventory linking for export declarations</span></a>
    <ul>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/inventory-linking-export-declarations.html#consolidation-of-consignments"><span>Consolidation of consignments</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/inventory-linking-export-declarations.html#movement-of-goods"><span>Movement of goods</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/inventory-linking-export-declarations.html#query"><span>Query</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/arrival-notifications.html"><span>Making arrival notifications</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/validating-import-movements.html"><span>Validate import movements (CSP Only)</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html"><span>Glossary</span></a>
    <ul>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#import-declaration-types"><span>Import Declaration Types:</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#export-declaration-types"><span>Export Declaration Types:</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#eori"><span>EORI</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#icr"><span>ICR</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#ics"><span>ICS</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#inventory-reference"><span>Inventory Reference</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#lrn"><span>LRN</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#mrn"><span>MRN</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#office-of-entry"><span>Office of Entry</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#participants"><span>Participants</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#roe"><span>ROE</span></a>
      </li>
      <li>
        <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/glossary.html#ucrs"><span>UCRs</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/guides/customs-declarations-end-to-end-service-guide/documentation/appendix.html"><span>Appendix</span></a>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <h1 id="file-upload-service">File Upload Service</h1>
<p>This section describes the technical steps required to send a document to CDS using the file upload API endpoint on the Customs Declaration API. In addition, it outlines the business processes associated with the file upload process to provide the user with an understanding of how this section is linked with declaration processing on CDS.</p>
<p>The Document Upload UI is out of scope for this service guide and will be covered in a separate user guide produced by the CDS programme.</p>
<h3 id="background">Background</h3>
<p>Currently, CHIEF does not provide Traders with a service to digitally upload documentation to support the processing of Customs Import/Export Declarations. Traders provide the supporting documentation via a multitude of channels and document mediums and HMRC National Clearance Hub (NCH) caseworkers currently manually receive and process documentation provided by declarants in support of submitted Customs declarations.</p>
<p>Under the Customs Declaration Service (CDS), HMRC has delivered the CDS Digital Secure File Upload Service to remove the need for the manual processing of supporting documentation for declarations submitted on CDS. The CDS Digital Secure File Upload Service allows the documentation uploaded in support of a declaration to be automatically transferred into HMRC’s case management solution for review.</p>
<h2 id="document-upload-process">Document Upload Process</h2>
<h4 id="process-overview">Process Overview</h4>
<p>The File Upload API will accept requests from the trader’s software to upload a number of files for a given declaration ID (MRN) and respond with a location (URL) to upload each file. The trader will then upload each file into an inbound file bucket.</p>
<p>The API will return a unique file reference code to the software for each file successfully submitted by the trader via a Digital notification. This file reference code can be used in future correspondence with HMRC. Please note that the submitter of the file will not receive a confirmation notification from back-end CDS systems that confirm the file has been matched to the declaration.</p>
<p>The CDS system uses the MRN to link documents uploaded via the Secure File Upload Service and the original declaration. HMRC Caseworkers will be notified when each document uploaded by the trader is received and also when all files uploaded together as a group for a declaration have been received. When all files have been received, HMRC Caseworkers will review the documents they contain against the case for the declaration ID provided in the original API call.</p>
<p>Currently, if an HMRC Caseworker requires a submission of supporting documents, the Trader will be notified via email. If the HMRC Caseworker finds any issues with the submitted documents, they will notify the trader to upload their documents again. Under current processes, the NCH will contact the declarant via email in the event that further information is required. HMRC is currently working to deliver an automated solution for handling such requests and this document will be updated once the solution has been confirmed.</p>
<p>In such cases, the HMRC caseworker will also reset any SLAs defined around this process.</p>
<p>The files uploaded by the trader will be scanned for malware and then stored in HMRC’s document repository system where they will be retained in accordance with HMRC policies (6 + current year).</p>
<h4 id="initiating-an-upload-and-documentary-controls">Initiating an Upload and Documentary Controls</h4>
<p>An authenticated trader may use the service at any time to submit files containing their documents required to support the declarations made by them.</p>
<p>In some cases, a trader may have also received a DMSDOC notification triggered by the declaration risking process (Route 1 or Route 3) to submit their documents for a declaration that they have submitted. However, it is not necessary to wait for a DMSDOC notification to upload a file to HMRC via the CDS Digital Secure File Upload Service.</p>
<p>It should be noted that the DMSDOC notification will not link to the Secure File Upload Service, nor will it specify the documents which must be uploaded. The same applies to CSP notifications and the Declaration Information API which return the routing status for the declaration, but not which document(s) are required (see Section 1.3 References). In the event of a documentary check, a declarant can either choose to upload the particular document that is expected to have triggered the control (e.g. a licence document) or all documentation associated with the declaration.</p>
<h2 id="using-the-file-upload-api-endpoint">Using the File-Upload API endpoint</h2>
<p>File upload is a multi-stage process. It starts with a single call to an endpoint on the Customs Declarations service to request S3 upload metadata for sending one or more files. This call returns one or more URLs with related “Fields”. These in turn are split into separate upload requests to S3, one per file.</p>
<h3 id="high-level-steps">High-level Steps</h3>
<h4 id="phase-1-request-the-url">Phase 1 – Request the URL</h4>
<h5 id="step-1-initiate-upload">Step 1 - Initiate upload</h5>
<p>Start the sequence of steps with a call to the file upload endpoint on the Customs Declarations service. This can be for one or more files. The payload schema can be found in the zip of schemas and example messages in the Customs Declarations documentation on the Developer Hub. Examples are provided below.</p>
<h5 id="step-2-parse-response">Step 2 - Parse response</h5>
<p>For each file specified in the initiate request, the response will contain a one-time S3 URL used to upload a file and a collection of name/value pairs in a “Fields” collection to send with the file upload.</p>
<p>Multiple individual sets of urls and “Fields” collections may be returned. E.g. if five files are initiated in the request above then five URLs with five linked “Fields” collections will be returned in the payload response.</p>
<h4 id="phase-2-upload-the-files">Phase 2 – Upload the Files</h4>
<h5 id="step-3-post-the-file">Step 3 - POST the file</h5>
<p>For each file specified in the initiate request, compose a POST request to the S3 URL. In the fields of the form include all the name/value pairs taken from the “Fields” collection in the initiate response payload. Include the actual file to upload as the final field in the form with the name “file”.</p>
<h5 id="step-4-await-notification">Step 4 - Await notification</h5>
<p>An asynchronous notification will indicate the success or failure of the upload. These are retrieved like declaration notifications. Failures can be due to invalid file types, files too large etc.</p>
<h3 id="process-flow">Process Flow</h3>
<p>The diagram below outlines the high-level functionality described in this Phase 2 above.</p>
<p><a href="/documentation/resources/file-upload-process-flow.png" target="_blank" rel="noopener noreferrer"><img src="/guides/customs-declarations-end-to-end-service-guide/documentation/resources/file-upload-process-flow.png" alt="Comm" /></a></p>
<h2 id="detailed-steps">Detailed Steps</h2>
<h3 id="detailed-steps-step-1-initiate-upload">Step 1 - Initiate upload</h3>
<p>Call the <code>/customs/declarations/file-upload</code> endpoint to initiate the file-upload process.
A typical request payload -</p>
<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;hmrc:FileUploadRequest</span> <span class="na">xmlns:hmrc=</span><span class="s">"hmrc:fileupload"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;hmrc:DeclarationID&gt;</span>DEC123<span class="nt">&lt;/hmrc:DeclarationID&gt;</span>
 <span class="nt">&lt;hmrc:FileGroupSize&gt;</span>1<span class="nt">&lt;/hmrc:FileGroupSize&gt;</span>
 <span class="nt">&lt;hmrc:Files&gt;</span>
   <span class="nt">&lt;hmrc:File&gt;</span>
     <span class="nt">&lt;hmrc:FileSequenceNo&gt;</span>1<span class="nt">&lt;/hmrc:FileSequenceNo&gt;</span>
     <span class="nt">&lt;hmrc:DocumentType&gt;</span>Licence<span class="nt">&lt;/hmrc:DocumentType&gt;</span>
   <span class="nt">&lt;/hmrc:File&gt;</span>
 <span class="nt">&lt;/hmrc:Files&gt;</span>
<span class="nt">&lt;/hmrc:FileUploadRequest&gt;</span>
</code></pre></div><h4 id="rules-for-file-initiation-requests">Rules for File Initiation Requests</h4>

<ul>
<li>A maximum of 11 files may be initiated in a single request. To initiate two file uploads with no optional elements e.g.</li>
</ul>
<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;hmrc:FileUploadRequest</span> <span class="na">xmlns:hmrc=</span><span class="s">"hmrc:fileupload"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;hmrc:DeclarationID&gt;</span>DEC123<span class="nt">&lt;/hmrc:DeclarationID&gt;</span>
       <span class="nt">&lt;hmrc:FileGroupSize&gt;</span>2<span class="nt">&lt;/hmrc:FileGroupSize&gt;</span>
       <span class="nt">&lt;hmrc:Files&gt;</span>
         <span class="nt">&lt;hmrc:File&gt;</span>
           <span class="nt">&lt;hmrc:FileSequenceNo&gt;</span>1<span class="nt">&lt;/hmrc:FileSequenceNo&gt;</span>
         <span class="nt">&lt;/hmrc:File&gt;</span>
         <span class="nt">&lt;hmrc:File&gt;</span>
           <span class="nt">&lt;hmrc:FileSequenceNo&gt;</span>2<span class="nt">&lt;/hmrc:FileSequenceNo&gt;</span>
         <span class="nt">&lt;/hmrc:File&gt;</span>
       <span class="nt">&lt;/hmrc:Files&gt;</span>
      <span class="nt">&lt;/hmrc:FileUploadRequest&gt;</span>
</code></pre></div>
<ul>
<li><p>The permitted file types are pdf, jpg/jpeg, png, and txt which correspond to the following mime types (note the type is determined from the file contents and not the extension) -</p>

<ul>
<li>application/pdf</li>
<li>image/jpeg</li>
<li>image/png</li>
<li>text/plain</li>
</ul></li>
<li><p>Optional SuccessRedirect and ErrorRedirect elements (example below) may be added to each file upload to redirect when there is a successful or failed upload. This is intended for developers creating UI applications that interact with this endpoint. For API interactions it can be ignored.</p></li>
</ul>
<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;hmrc:FileUploadRequest</span> <span class="na">xmlns:hmrc=</span><span class="s">"hmrc:fileupload"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;hmrc:DeclarationID&gt;</span>DEC123<span class="nt">&lt;/hmrc:DeclarationID&gt;</span>
          <span class="nt">&lt;hmrc:FileGroupSize&gt;</span>1<span class="nt">&lt;/hmrc:FileGroupSize&gt;</span>
          <span class="nt">&lt;hmrc:Files&gt;</span>
            <span class="nt">&lt;hmrc:File&gt;</span>
              <span class="nt">&lt;hmrc:FileSequenceNo&gt;</span>1<span class="nt">&lt;/hmrc:FileSequenceNo&gt;</span>
              <span class="nt">&lt;hmrc:DocumentType&gt;</span>Licence<span class="nt">&lt;/hmrc:DocumentType&gt;</span>
              <span class="nt">&lt;hmrc:SuccessRedirect&gt;</span>https://success-redirect.com<span class="nt">&lt;/hmrc:SuccessRedirect&gt;</span>
              <span class="nt">&lt;hmrc:ErrorRedirect&gt;</span>https://error-redirect.com<span class="nt">&lt;/hmrc:ErrorRedirect&gt;</span>
            <span class="nt">&lt;/hmrc:File&gt;</span>
          <span class="nt">&lt;/hmrc:Files&gt;</span>
        <span class="nt">&lt;/hmrc:FileUploadRequest&gt;</span>
</code></pre></div><h4 id="http-headers">Http Headers</h4>
<p>The headers are described in detail in the file-upload endpoint section of the  Customs Declarations service on the Developer Hub. To summarise, they are -</p>
<div class="table-container">
        <table>
          <tr>
<th>Header Name</th>
<th>Mandatory?</th>
<th>Example</th>
<th>Notes</th>
</tr>
<tr>
<td>Accept</td>
<td>Yes</td>
<td>application/vnd.hmrc.2.0+xml</td>
<td>1</td>
</tr>
<tr>
<td>Content-Type</td>
<td>Yes</td>
<td>application/xml; charset=UTF-8</td>
<td></td>
</tr>
<tr>
<td>X-Badge-Identifier</td>
<td>For CSPs</td>
<td>ABC123</td>
<td></td>
</tr>
<tr>
<td>X-Eori-Identifier</td>
<td>For CSPs</td>
<td>GB123456789000</td>
<td></td>
</tr>

        </table>
      </div>
<ol>
<li>Accept headers by environment -</li>
</ol>

<ul>
<li>Production - application/vnd.hmrc.1.0+xml</li>
<li>Trade Test - application/vnd.hmrc.2.0+xml</li>
<li>Trader Dress Rehearsal - application/vnd.hmrc.1.0+xml
See screenshot below for an example using Postman.</li>
</ul>
<h4 id="response-codes">Response Codes</h4>
<p>A successful initiate upload returns a 200 OK code with a payload containing an S3 href and a fields collection, one per file upload initiated (see Step 2 below).</p>
<p>A failure is indicated by a 4XX or 5XX code. E.g.</p>
<p>For an invalid XML Payload an error code 400 is returned with the following body -</p>
<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;errorResponse&gt;</span>
  <span class="nt">&lt;code&gt;</span>BAD_REQUEST<span class="nt">&lt;/code&gt;</span>
  <span class="nt">&lt;message&gt;</span>Payload is not valid according to schema<span class="nt">&lt;/message&gt;</span>
  <span class="nt">&lt;errors&gt;</span>
    <span class="nt">&lt;error&gt;</span>
      <span class="nt">&lt;code&gt;</span>xml_validation_error<span class="nt">&lt;/code&gt;</span>
      <span class="nt">&lt;message&gt;</span>Error at line 13, column 13: no declaration found for element 'unknown'<span class="nt">&lt;/message&gt;</span>
    <span class="nt">&lt;/error&gt;</span>
  <span class="nt">&lt;/errors&gt;</span>
<span class="nt">&lt;/errorResponse&gt;</span>
</code></pre></div><p>For an internal server error an error code 500 is returned with the following body -</p>
<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;errorResponse&gt;</span>
  <span class="nt">&lt;code&gt;</span>INTERNAL_SERVER_ERROR<span class="nt">&lt;/code&gt;</span>
  <span class="nt">&lt;message&gt;</span>Internal server error<span class="nt">&lt;/message&gt;</span>
<span class="nt">&lt;/errorResponse&gt;</span>
</code></pre></div><p>For other errors see the Developer Hub <a href="api-documentation/docs/reference-guide" rel="noopener noreferrer">documentation</a>.</p>
<h3 id="detailed-steps-step-2-parse-response">Step 2 - Parse response</h3>
<p>A typical response payload resulting from the first request above -</p>
<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;FileUploadResponse</span> <span class="na">xmlns=</span><span class="s">"hmrc:fileupload"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;Files&gt;</span>
       <span class="nt">&lt;File&gt;</span>
           <span class="nt">&lt;Reference&gt;</span>3245a5c2-a128-4205-8a8d-f2dcdb549999<span class="nt">&lt;/Reference&gt;</span>
           <span class="nt">&lt;UploadRequest&gt;</span>
               <span class="nt">&lt;Href&gt;</span>https://fus-inbound-8264eea94f87aa9999.s3.amazonaws.com<span class="nt">&lt;/Href&gt;</span>
               <span class="nt">&lt;Fields&gt;</span>
  <span class="nt">&lt;x-amz-meta-callback-url&gt;</span>https://some-callback-url<span class="nt">&lt;/x-amz-meta-callback-url&gt;</span>
  <span class="nt">&lt;x-amz-date&gt;</span>20200811T081107Z<span class="nt">&lt;/x-amz-date&gt;</span>
  <span class="nt">&lt;x-amz-credential&gt;</span>AKIAIHSAVV7BWA/209999/eu-west-2/s3/aws4_request<span class="nt">&lt;/x-amz-credential&gt;</span>
  <span class="nt">&lt;x-amz-meta-upscan-initiate-response&gt;</span>2020-08-11T08:11:07.126Z<span class="nt">&lt;/x-amz-meta-upscan-initiate-response&gt;</span>
  <span class="nt">&lt;x-amz-meta-upscan-initiate-received&gt;</span>2020-08-11T08:11:07.126Z<span class="nt">&lt;/x-amz-meta-upscan-initiate-received&gt;</span>
 <span class="nt">&lt;x-amz-meta-request-id&gt;</span>n/a<span class="nt">&lt;/x-amz-meta-request-id&gt;</span>
 <span class="nt">&lt;x-amz-meta-original-filename&gt;</span>${filename}<span class="nt">&lt;/x-amz-meta-original-filename&gt;</span>
 <span class="nt">&lt;x-amz-algorithm&gt;</span>AWS4-HMAC-SHA256<span class="nt">&lt;/x-amz-algorithm&gt;</span>
 <span class="nt">&lt;key&gt;</span>3245a5c2-a128-4205-8a8d-f2dcdb549999<span class="nt">&lt;/key&gt;</span>
 <span class="nt">&lt;acl&gt;</span>private<span class="nt">&lt;/acl&gt;</span>
 <span class="nt">&lt;x-amz-signature&gt;</span>0b0f92e7fb8ad67b5973711a7d059184349a2<span class="nt">&lt;/x-amz-signature&gt;</span>
 <span class="nt">&lt;x-amz-meta-session-id&gt;</span>n/a<span class="nt">&lt;/x-amz-meta-session-id&gt;</span>
 <span class="nt">&lt;x-amz-meta-consuming-service&gt;</span>customs-declarations<span class="nt">&lt;/x-amz-meta-consuming-service&gt;</span>
 <span class="nt">&lt;policy&gt;</span>eyJleHBpcmF0aW9uIjoiMj....<span class="nt">&lt;/policy&gt;</span>
               <span class="nt">&lt;/Fields&gt;</span>
           <span class="nt">&lt;/UploadRequest&gt;</span>
       <span class="nt">&lt;/File&gt;</span>
   <span class="nt">&lt;/Files&gt;</span>
<span class="nt">&lt;/FileUploadResponse&gt;</span>
</code></pre></div><p>Note that when multiple files are initiated in the request a single response is returned containing multiple File elements. Each of these are then composed into separate POST requests to S3 - see next step.</p>
<h3 id="step-3-upload-the-file">Step 3 - Upload the file</h3>
<p>Upload a file by</p>

<ul>
<li>Executing a http POST request containing a form submission to the url extracted from the &ldquo;Href&rdquo; field in the response above</li>
<li>Include all the name/value pairs from the &ldquo;Fields&rdquo; collection in the form </li>
<li>The &ldquo;file&rdquo; field containing the upload file must be the last field in the submitted form</li>
<li>Use multipart encoding (multipart/form-data)</li>
<li>Each file size must not exceed 10MB</li>
<li>The one-time url and associated metadata expires after 7 days. If the file is not uploaded in that time, then a new initiate request will be needed.</li>
<li>See the AWS S3 <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev" rel="noopener noreferrer">documentation</a> for more details including response and error codes</li>
</ul>
<p>If multiple files are specified in the initiate request, then there will be an equivalent number of File elements in the response containing separate urls and Fields collections. Each of these should be composed into separate S3 upload requests.</p>
<p>See screenshot below for an example using Postman.</p>
<h3 id="detailed-steps-step-4-await-notification">Step 4 - Await notification</h3>
<p>A notification indicating the success or failure of the upload will be sent after a short period of time. These are sent like any other declaration notification. There is one notification per file uploaded to S3.</p>
<p>If declaration notifications are &ldquo;pushed&rdquo; then file upload notifications will be pushed too. In this case the ConversationId HTTP header will be set to the &ldquo;Reference&rdquo; element in the file-upload response.</p>
<p>For &ldquo;pull&rdquo; notifications they can be retrieved by using the id in the “Reference” element in the file-upload response as the conversationId.</p>
<p>Failure reasons include too large a file, invalid file type, virus detected etc.</p>
<p>A typical successful notification is -</p>
<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;Root</span> <span class="na">xmlns=</span><span class="s">"hmrc:fileupload"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;FileReference&gt;</span>3245a5c2-a128-4205-8a8d-f2dcdb54296b<span class="nt">&lt;/FileReference&gt;</span>
  <span class="nt">&lt;BatchId&gt;</span>904067f4-0da4-47b7-8702-66eb76c72d97<span class="nt">&lt;/BatchId&gt;</span>
  <span class="nt">&lt;FileName&gt;</span>Sample for S3 upload.pdf<span class="nt">&lt;/FileName&gt;</span>
  <span class="nt">&lt;Outcome&gt;</span>SUCCESS<span class="nt">&lt;/Outcome&gt;</span>
  <span class="nt">&lt;Details&gt;</span>Thank you for submitting your documents. Typical clearance times are 2 hours for air and 3 hours for maritime declarations. During busy periods wait times may be longer.<span class="nt">&lt;/Details&gt;</span>
<span class="nt">&lt;/Root&gt;</span>
</code></pre></div><p>A typical failure notification is -</p>
<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;Root</span> <span class="na">xmlns=</span><span class="s">"hmrc:fileupload"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;FileReference&gt;</span>ff7c82a9-21b1-4f73-a60d-984c7d03324e<span class="nt">&lt;/FileReference&gt;</span>
  <span class="nt">&lt;Outcome&gt;</span>REJECTED<span class="nt">&lt;/Outcome&gt;</span>
  <span class="nt">&lt;Details&gt;</span>MIME type [image/gif] is not allowed for service: [customs-declarations]<span class="nt">&lt;/Details&gt;</span>
<span class="nt">&lt;/Root&gt;</span>
</code></pre></div><h2 id="file-upload-capabilities-in-external-test">File Upload Capabilities in External Test</h2>
<p>Due to technical limitations, the file upload service in External Test is not fully integrated with the CDS back-end. This is to allow for automated resolution of controls without a requirement for manual intervention as part of continued testing with external parties.</p>
<p>A documentary control can be triggered in External Test by using the appropriate ‘trigger word’ in the Goods Description field for the commodity code (e.g. timportsdocblocking). Subsequently, it is possible for users of External Test to upload a file via the file upload endpoint. However, please be aware that these two processes will not be linked and the uploading of a file is not necessary to resolve an open documentary control in either External Test environment.</p>
<p>There are not currently plans to deliver the Secure File Upload UI into either of the External Test services (Trade Test, Trader Dress Rehearsal).</p>
<h4 id="trade-test">Trade Test</h4>
<h5 id="functionality-from-ttm11-0">Functionality from TTM11.0</h5>
<p>Beginning in August 2020 (TTM11.0), the functionality available in Trade Test will be expanded to provide a richer experience that more closely aligns to the behaviour in Production. The revised capability in Trade Test for the file upload API endpoint will be as follows:</p>

<ol>
<li>The end user submits a request to the customs/declarations/file-upload endpoint </li>
<li>A synchronous http 200 response is returned to the end user along with a response body containing the S3 bucket location and other details required for the file upload. These are real S3 bucket details and none of the information is stubbed. </li>
<li>End user would upload the file to s3 bucket location in a POST call by providing the details returned from step 2 for the following type of files -
application/pdf,application/msword,application/vnd.ms-excel,image/png,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,image/jpeg,text/plain</li>
<li>The file will undergo virus scan checks and if the scan is successful the end user will be notified via an asynchronous notification that the file upload has been successful otherwise they will be notified that the file has failed the virus scan and has been quarantined. This notification will be received as a push or pull notification, depending on the presence or absence of a callback url during the API subscription process.</li>
</ol>
<h4 id="trader-dress-rehearsal">Trader Dress Rehearsal</h4>
<p>From August 2020, the file upload API endpoint will be available in the Trader Dress Rehearsal with the same functionality outlined above for Trade Test as delivered in TTM11.0.</p>
<h3 id="screenshots-using-postman">Screenshots using Postman</h3>
<h4 id="sample-file-upload-initiate-request-and-response">Sample file-upload initiate request and response</h4>
<p><a href="/documentation/resources/file-upload-initiate.png" target="_blank" rel="noopener noreferrer"><img src="/guides/customs-declarations-end-to-end-service-guide/documentation/resources/file-upload-initiate.png" alt="initiate" /></a></p>
<h4 id="sample-s3-upload-request-and-response-result-with-headers">Sample S3 upload request and response result with headers</h4>
<p><a href="/documentation/resources/s3-upload.png" target="_blank" rel="noopener noreferrer"><img src="/guides/customs-declarations-end-to-end-service-guide/documentation/resources/s3-upload.png" alt="s3-upload" /></a></p>

            
          </main>

          <aside>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43414424-1', 'auto');
  ga('set', 'anonymizeIp', true);
  ga('set', 'displayFeaturesTask', null);
  ga('set', 'transport', 'beacon');
  ga('set', 'page', location.pathname+location.search+location.hash);
  ga('send', 'pageview');
  </script>

    <script src="/guides/customs-declarations-end-to-end-service-guide/javascripts/application.js"></script>
  </body>
</html>
